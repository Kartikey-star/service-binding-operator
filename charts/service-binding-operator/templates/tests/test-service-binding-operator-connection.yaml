---
apiVersion: v1
kind: Pod
metadata:
  name: "{{ .Release.Name }}-test"
  annotations:
    "helm.sh/hook": test-success
spec:
  containers:
    - name: "{{ .Release.Name }}-test"
      image: "quay.io/service-binding/helm-chart-test:latest"
      imagePullPolicy: "Always"
      env:
        - name: KUBECONFIG
          value: /k-cfg/kubeconfig
        - name: TEST_NAMESPACE
          value: {{.Release.Namespace}}
        - name: KEEP_TEST_RESOURCES
          value: "{{ .Values.keepTestResources }}"
      volumeMounts:
      - name: k-config
        mountPath: /k-cfg
  restartPolicy: Never
  volumes:
  - name: k-config
    secret:
      secretName: my-k-config