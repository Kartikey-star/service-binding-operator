---
apiVersion: v1
kind: Pod
metadata:
  name: "{{ .Release.Name }}-test"
  annotations:
    "helm.sh/hook": test-success
spec:
  containers:
    - name: "{{ .Release.Name }}-test"
      image: "quay.io/service-binding/helm-test:latest"
      imagePullPolicy: "Always"
      env:
        - name: SBO_REPO
          value: https://github.com/redhat-developer/service-binding-operator.git
        - name: SBO_REPO_COMMIT
          value: master
        - name: KUBECONFIG
          value: /tmp/config
        - name: KUBECONFIGORIGIN
          value: /k-cfg/kubeconfig
      volumeMounts:
      - name: k-config
        mountPath: /k-cfg
      command: ["/bin/sh"]
      args:
      - -ec
      - |
         cp $KUBECONFIGORIGIN $KUBECONFIG &&
         /test-chart-entrypoint.sh
  restartPolicy: Never
  volumes:
  - name: k-config
    secret:
      secretName: my-k-config